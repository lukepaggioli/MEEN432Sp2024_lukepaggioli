% Define track parameters
track_radius = 200;   % Radius of curved sections [m]
track_offset = 7.5;   % Offset for inner and outer lines
track_radius_in = track_radius - track_offset; %using offset to define inner and outer radii
track_radius_out = track_radius + track_offset;
track_length = 900;   % Length of straight sections [m]

tic; % start the tic timer

% Number of points in each section
num_points = 50;  
theta = linspace(-pi/2, pi/2, num_points); %define angle from -90 to 90 deg

% Track
x_straightB = linspace(-track_length/2, track_length/2, num_points);
y_straightB = zeros(size(x_straightB));
x_straightT = linspace(track_length/2, -track_length/2, num_points);
y_straightT = (track_radius * 2) * ones(size(x_straightT));

x_curveR = track_length/2 + track_radius * cos(theta);
y_curveR = track_radius + track_radius * sin(theta);
x_curveL = flip(-track_length/2 - track_radius * cos(theta));
y_curveL = flip(track_radius + track_radius * sin(theta));

% Inner Track 
x_straightB_in = x_straightB;
y_straightB_in = track_offset * ones(size(x_straightB_in));
x_straightT_in = x_straightT;
y_straightT_in = (track_radius * 2 - track_offset) * ones(size(x_straightT_in));

x_curveR_in = track_length/2 + track_radius_in * cos(theta);
y_curveR_in = track_radius + track_radius_in * sin(theta);
x_curveL_in = flip(-track_length/2 - track_radius_in * cos(theta));
y_curveL_in = flip(track_radius + track_radius_in * sin(theta));

% Outer Track
x_straightB_out = x_straightB;
y_straightB_out = -track_offset * ones(size(x_straightB_out));
x_straightT_out = x_straightT;
y_straightT_out = (track_radius * 2 + track_offset) * ones(size(x_straightT_out));

x_curveR_out = track_length/2 + track_radius_out * cos(theta);
y_curveR_out = track_radius + track_radius_out * sin(theta);
x_curveL_out = flip(-track_length/2 - track_radius_out * cos(theta));
y_curveL_out = flip(track_radius + track_radius_out * sin(theta));

% Combining pieces of all 3 plots
x_center = [x_straightB, x_curveR, x_straightT, x_curveL];
y_center = [y_straightB, y_curveR, y_straightT, y_curveL];

x_inner = [x_straightB_in, x_curveR_in, x_straightT_in, x_curveL_in];
y_inner = [y_straightB_in, y_curveR_in, y_straightT_in, y_curveL_in];

x_outer = [x_straightB_out, x_curveR_out, x_straightT_out, x_curveL_out];
y_outer = [y_straightB_out, y_curveR_out, y_straightT_out, y_curveL_out];

%defining Car constants being applied in Simulink

axel_distances = [1.6,1.4];
stiffs = [200,180];
mass_inert = [80,1];
v_max = 22;
l= 2;

I_out = 1; %lb-ft^2
tau_w_max = 2800; %lb-ft
I_w = 1.7; %lb-ft^2
m = 80; %lb
r_w = 1.4; %ft
r = 1.4; %ft
N_b_max = 10000; %lb
g_b = 2.1;
mu_b = 0.7;
G = 1/r;
mu = 0.8;
nom_stiff = 50;
lambda_max = 0.1;
gear_ratio = 10;


scaleFactor = 0.75;
%Electric Motor Data - corresponds to the HVH250-090 Electric Motor
rpm =       [0,  1000,2000,3000,4000,5000,6000,7000,8000,9000,10000,11000, 12000];
maxtorque = [0, 0, 0, 0, 0, 0,  0,  0,  0,  0,   0,   0,     0;
             280, 280, 280, 220, 160, 110,  95,  75,  60,  55,   50,   40,     0;
             280, 280, 275, 255, 240, 180, 140, 125,  95,  75,   70,   50,     0;
             280, 280, 275, 260, 250, 220, 180, 150, 125, 100,   80,   70,     0;
             280, 280, 275, 260, 250, 230, 200, 175, 140, 120,  100,   75,     0] * scaleFactor;
vbus = [250, 350, 500, 600, 700]*scaleFactor;

eta_torque = [0:25:325] * 280/325 * scaleFactor;
eta_speed = [0:500:10000];
eta_speed(1) = 10;
eta_val = [0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000,0.740000000000000;
    0.860000000000000,0.940000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.860000000000000,0.860000000000000,0.860000000000000,0.860000000000000,0.840000000000000,0.820000000000000,0.800000000000000,0.780000000000000,0.760000000000000,0.740000000000000;
    0.840000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.960000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.880000000000000;
    0.840000000000000,0.920000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.880000000000000;
    0.820000000000000,0.900000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.880000000000000,0.880000000000000;
    0.820000000000000,0.880000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.880000000000000,0.860000000000000,0.860000000000000;
    0.800000000000000,0.880000000000000,0.920000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.800000000000000,0.860000000000000,0.900000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.780000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.96000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.780000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.96000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.760000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.740000000000000,0.840000000000000,0.860000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.9000000000000000;
    .740000000000000,0.840000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.940000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000;
    0.720000000000000,0.820000000000000,0.860000000000000,0.880000000000000,0.900000000000000,0.900000000000000,0.920000000000000,0.920000000000000,0.920000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000,0.900000000000000];
eta_val = eta_val .* eta_val;

inertia = 0.5; % Kg-m^2

% Conversion
mph2mps = 1600/3600;

SOC=[0, 0.01,   .1,  .2,  .3,  .4,  .5,  .6, .7,  .8,  .9,   1]; % soc
OCV=[0, 3.1,3.55,3.68,3.74,3.76,3.78,3.85,3.9,3.95,4.08,4.15];  % OCV per cell
Rint=0.1695; % internal resistance per cell
C = 150; % Amp hr total battery capacity
numSeries = 96;
numParallel = 74;
